Хочется добавить тестирование.

Программа считывает ввод из порта командами in, выводит результаты командами out.

Тест, соответственно, должен выводить в порт (извне, моделируя ввод пользователя) то, что вводится программой и вводить то, что выводится.
Таким образом, отдельно взятый тест это не пара вход-выход, это линейная последовательность вводимых и считываемых тестом байт.

Например, если программа пользователя находит произведение двух байт (ввод программы), и выводит два байта результата (первой старшую часть, второй --- младшую), то тест будет таким:

out 4;
out 5;
in 0;
in 20;

Логично объединить несколько тестов в один файл и тогда получим нечто вроде:

    test "4*5=20" {
     out 4;
     out 5;
     in 0; //в аргументе in указывается константа-ожидаемый результат (вывод программы) 
     in 20;
    }
    test "100*5=500(i.e. 0x1F4)" {
     out 100;
     out 5;
     in 1;
     in 0xF4;
    }

Тесты можно создавать вручную. Идея генерировать их на основе корректно работающей программы (если это имелось ввиду) кажется интересной.